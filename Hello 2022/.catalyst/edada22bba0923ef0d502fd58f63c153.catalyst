{"title":{"en":"H. Trains and Airplanes","ru":"H. Поезда и самолёты"},"contestId":"1621","problemIndex":"H","timeLimit":{"en":"4 seconds","ru":"4 секунды"},"memLimit":{"en":"512 megabytes","ru":"512 мегабайт"},"inputFormat":{"en":"standard input","ru":"стандартный ввод"},"outputFormat":{"en":"standard output","ru":"стандартный вывод"},"problemHtml":{"en":"<p>Railway network of one city consists of $$$n$$$ stations connected by $$$n-1$$$ roads. These stations and roads forms a tree. Station $$$1$$$ is a city center. For each road you know the time trains spend to pass this road. You can assume that trains don't spend time on stops. Let's define $$$dist(v)$$$ as the time that trains spend to get from the station $$$v$$$ to the station $$$1$$$.</p><p>This railway network is splitted into zones named by first $$$k$$$ capital latin letters. The zone of the $$$i$$$-th station is $$$z_i$$$. City center is in the zone A. For all other stations it is guaranteed that the first station on the road from this station to the city center is either in the same zone or in the zone with lexicographically smaller name. Any road is completely owned by the zone of the most distant end from the city center.</p><p>Tourist will arrive at the airport soon and then he will go to the city center. Here's how the trip from station $$$v$$$ to station $$$1$$$ happends: </p><ul> <li> At the moment $$$0$$$, tourist enters the train that follows directly from the station $$$v$$$ to the station $$$1$$$. The trip will last for $$$dist(v)$$$ minutes. </li><li> Tourist can by tickets for any subset of zones at any moment. Ticket for zone $$$i$$$ costs $$$pass_i$$$ euro. </li><li> Every $$$T$$$ minutes since the start of the trip (that is, at the moments $$$T, 2T, \\ldots$$$) the control system will scan tourist. If at the moment of scan tourist is in the zone $$$i$$$ without zone $$$i$$$ ticket, he should pay $$$fine_i$$$ euro. Formally, the zone of tourist is determined in the following way: <ul> <li> If tourist is at the station $$$1$$$, then he already at the city center so he shouldn't pay fine. </li><li> If tourist is at the station $$$u \\neq 1$$$, then he is in the zone $$$z_u$$$. </li><li> If tourist is moving from the station $$$x$$$ to the station $$$y$$$ that are directly connected by road, then he is in the zone $$$z_x$$$. </li></ul> Note, that tourist can pay fine multiple times in the same zone. </li></ul><p>Tourist always selects such way to buy tickets and pay fines that minimizes the total cost of trip. Let $$$f(v)$$$ be such cost for station $$$v$$$.</p><p>Unfortunately, tourist doesn't know the current values of $$$pass_i$$$ and $$$fine_i$$$ for different zones and he has forgot the location of the airport. He will ask you queries of $$$3$$$ types:</p><ul> <li> $$$1$$$ $$$i$$$ $$$c$$$&nbsp;— the cost of <span class=\"tex-font-style-bf\">ticket</span> in zone $$$i$$$ has changed. Now $$$pass_i$$$ is $$$c$$$. </li><li> $$$2$$$ $$$i$$$ $$$c$$$&nbsp;— the cost of <span class=\"tex-font-style-bf\">fine</span> in zone $$$i$$$ has changed. Now $$$fine_i$$$ is $$$c$$$. </li><li> $$$3$$$ $$$u$$$&nbsp;— solve the following problem for current values of $$$pass$$$ and $$$fine$$$: <ul> <li> You are given the station $$$u$$$. Consider all the stations $$$v$$$ that satisfy the following conditions: <ul> <li> $$$z_v = z_u$$$ </li><li> The station $$$u$$$ is on the path from the station $$$v$$$ to the station $$$1$$$. </li></ul> Find the value of $$$\\min(f(v))$$$ over all such stations $$$v$$$ with the following assumption: <span class=\"tex-font-style-bf\">tourist has the ticket for the zone of station</span> $$$z_u$$$. </li></ul> </li></ul>","ru":"<p>Транспортная сеть одного крупного города состоит из $$$n$$$ станций, соединённых $$$n-1$$$ перегонами, и представляет собой дерево. Станция с номером $$$1$$$ является центром города. Для каждого перегона известно время в минутах, за которое его преодолевают поезда. Временем остановки поездов на станциях можно пренебречь. Обозначим за $$$dist(v)$$$ время, за которое можно доехать от станции $$$v$$$ до станции $$$1$$$.</p><p>Эта транспортная сеть разделена на зоны, для обозначения которых используются первые $$$k$$$ заглавных латинских букв. Зона станции $$$i$$$ обозначается как $$$z_i$$$. Центр города находится в зоне A. Для всех остальных станций выполнено, что ближайшая в направлении центра города станция находится в зоне с таким же, или лексикографически меньшим, обозначением. Любой перегон полностью принадлежит зоне его конца, более удалённого от центра города.</p><p>Турист летит в этот город на самолёте и по прибытии в аэропорт сразу направится в центр города. Опишем подробнее, как происходит поездка от станции $$$v$$$ до станции $$$1$$$:</p><ul> <li> В момент времени $$$0$$$ турист садится на поезд, который едет от станции $$$v$$$ до станции $$$1$$$ по кратчайшему пути. Поездка займёт $$$dist(v)$$$ минут. </li><li> В любой момент турист может купить билеты для любого подмножества зон. Билет для зоны $$$i$$$ стоит $$$pass_i$$$ евро. </li><li> Каждые $$$T$$$ минут с момента посадки на поезд (то есть в моменты $$$T, 2T, \\ldots$$$) его будет сканировать система контроля безбилетного проезда. Если туриста сканировали в зоне $$$i$$$ без билета для зоны $$$i$$$, он будет обязан заплатить штраф $$$fine_i$$$ евро. Зона в которой находится турист формально определяется следующим образом: <ul> <li> Если турист находится на станции $$$1$$$, то он уже доехал до центра города и не должен платить штраф. </li><li> Если турист находится на станции $$$u \\neq 1$$$, то он находится в зоне $$$z_u$$$. </li><li> Если турист едет по перегону от станции $$$x$$$ к станции $$$y$$$, то он находится в зоне $$$z_x$$$. </li></ul> Обратите внимание, что турист может заплатить штраф в одной зоне несколько раз. </li></ul><p>Турист всегда выберет такой способ оплаты проезда, который минимизирует количество потраченных евро. Для станции $$$v$$$ обозначим это число за $$$f(v)$$$.</p><p>К сожалению, турист не знает, чему равны текущие $$$pass_i$$$ и $$$fine_i$$$ для разных зон, а также не помнит, около какой станции находится аэропорт прибытия. Он будут делать разные предположения, а Вам предстоит обработать запросы $$$3$$$ видов:</p><ul> <li> $$$1$$$ $$$i$$$ $$$c$$$&nbsp;— запрос изменения стоимости <span class=\"tex-font-style-bf\">билета</span> в зоне $$$i$$$. Теперь $$$pass_i$$$ равно $$$c$$$. </li><li> $$$2$$$ $$$i$$$ $$$c$$$&nbsp;— запрос изменения <span class=\"tex-font-style-bf\">штрафа</span> в зоне $$$i$$$. Теперь $$$fine_i$$$ равно $$$c$$$. </li><li> $$$3$$$ $$$u$$$&nbsp;— решите следующую задачу для текущих значений $$$pass$$$ и $$$fine$$$: <ul> <li> Дана станция $$$u$$$. Рассмотрим множество станций $$$v$$$, удовлетворяющих двум следующим условиям: <ul> <li> $$$z_v = z_u$$$. </li><li> Станция $$$u$$$ находится на пути от станции $$$v$$$ до станции $$$1$$$. </li></ul> Найдите значение $$$\\min(f(v))$$$ по всем станциям $$$v$$$ из этого множества, в предположении, что <span class=\"tex-font-style-bf\">у туриста есть билет в зоне</span> $$$z_u$$$. </li></ul> </li></ul>"},"inSpecsHtml":{"en":"<div class=\"section-title\">Input</div><p>The first line contains the single integer $$$n$$$ ($$$2 \\leq n \\leq 2 \\cdot 10^5$$$)&nbsp;— the number of stations.</p><p>Each of the next $$$n - 1$$$ lines contains three integers $$$v_i$$$, $$$u_i$$$, $$$t_i$$$ ($$$1 \\leq v_i, u_i \\leq n, 1 \\leq t_i \\leq 10^9$$$)&nbsp;— the ends of the $$$i$$$-th road and the time it takes a train to pass this road. It is guaranteed that this roads forms a tree.</p><p>The next line contains the single integer $$$k$$$ ($$$1 \\leq k \\leq 26$$$)&nbsp;— the number of zones.</p><p>The next line contains $$$n$$$ symbols $$$z_1z_2 \\ldots z_n$$$&nbsp;— $$$z_i$$$ is the name of the zone of the $$$i$$$-th station. It is guaranteed that the conditions from the second paragraph are satisfied.</p><p>The next line contains $$$k$$$ integers $$$pass_1$$$, $$$pass_2$$$, $$$\\ldots$$$, $$$pass_k$$$ ($$$1 \\leq pass_i \\leq 10^9$$$)&nbsp;— initial costs of tickets.</p><p>The next line contains $$$k$$$ integers $$$fine_1$$$, $$$fine_2$$$, $$$\\ldots$$$, $$$fine_k$$$ ($$$1 \\leq fine_i \\leq 10^9$$$)&nbsp;— initial fines.</p><p>The next line contains the single integer $$$T$$$ ($$$1 \\leq T \\leq 10^9$$$)&nbsp;— the time gap between scans of control system.</p><p>The next line contains the single integer $$$q$$$ ($$$1 \\leq q \\leq 2 \\cdot 10^5$$$)&nbsp;— the number of queries.</p><p>Next $$$q$$$ lines contains queries as described in the statement. It is guaranteed that in the queries of the first and the second type $$$i$$$ is a correct name of the zone (one of the first $$$k$$$ capital latin letters) and $$$1 \\leq c \\leq 10^9$$$, and in the queries of the third type $$$1 \\leq u \\leq n$$$.</p>","ru":"<div class=\"section-title\">Входные данные</div><p>В первой строке дано число $$$n$$$ ($$$2 \\leq n \\leq 2 \\cdot 10^5$$$)&nbsp;— количество станций в транспортной сети.</p><p>Следующие $$$n - 1$$$ строка содержат по три числа $$$v_i$$$, $$$u_i$$$, $$$t_i$$$ ($$$1 \\leq v_i, u_i \\leq n, 1 \\leq t_i \\leq 10^9$$$)&nbsp;— концы $$$i$$$ перегона и время, за которое его преодолевают поезда. Гарантируется, что данные перегоны образуют дерево.</p><p>Следующая строка содержит число $$$k$$$ ($$$1 \\leq k \\leq 26$$$)&nbsp;— количество зон транспортной сети.</p><p>Следующая строка содержит $$$n$$$ символов $$$z_1z_2 \\ldots z_n$$$&nbsp;— где $$$z_i$$$ это обозначение зоны, в которой находится $$$i$$$ станция. Гарантируется, что условия из второго абзаца выполняются.</p><p>Следующая строка содержит $$$k$$$ чисел $$$pass_1$$$, $$$pass_2$$$, $$$\\ldots$$$, $$$pass_k$$$ ($$$1 \\leq pass_i \\leq 10^9$$$)&nbsp;— изначальные стоимости билетов.</p><p>Следующая строка содержит $$$k$$$ чисел $$$fine_1$$$, $$$fine_2$$$, $$$\\ldots$$$, $$$fine_k$$$ ($$$1 \\leq fine_i \\leq 10^9$$$)&nbsp;— изначальные размеры штрафов.</p><p>Следующая строка содержит число $$$T$$$ ($$$1 \\leq T \\leq 10^9$$$)&nbsp;— частоту сканирования туриста системой контроля безбилетного проезда.</p><p>Следующая строка содержит число $$$q$$$ ($$$1 \\leq q \\leq 2 \\cdot 10^5$$$)&nbsp;— количество запросов.</p><p>Следующие $$$q$$$ строк содержат запросы в описанном в условии формате. Гарантируется, что в запросах первого и второго вида $$$i$$$ является корректным обозначением зоны (одной из первых $$$k$$$ заглавных латинских букв) и $$$1 \\leq c \\leq 10^9$$$, а в запросах третьего вида $$$1 \\leq u \\leq n$$$.</p>"},"outSpecsHtml":{"en":"<div class=\"section-title\">Output</div><p>For each query of the third type print the answer to it.</p>","ru":"<div class=\"section-title\">Выходные данные</div><p>Для каждого запроса третьего вида выведите ответ на него в отдельной строке.</p>"},"noteHtml":{"en":"<div class=\"section-title\">Note</div><p>Note, that the fine can be cheaper than the pass.</p><center> <img class=\"tex-graphics\" src=\"https://espresso.codeforces.com/4ab3919d8b1770894a43b03b4881c6598c667543.png\" style=\"max-width: 100.0%;max-height: 100.0%;\"> <span class=\"tex-font-size-small\">The railway network from the example. Green color is used for stations and roads of zone A, blue color is used for zone B and red color is used for zone D. The integer near each road is time that trains spend to pass it.</span> </center><p>In the first query, the airport can be located near the station $$$2$$$ or near the station $$$4$$$. During the trip, tourist will always stay in the zone <span class=\"tex-font-style-tt\">A</span>. He already has the pass for this zone so the answer is $$$0$$$.</p><p>After the second query, the cost of the pass in the zone <span class=\"tex-font-style-tt\">A</span> has become $$$10$$$.</p><p>In the third query, the airport can be located only near the station $$$3$$$. Optimal solution will be to buy the pass for zone <span class=\"tex-font-style-tt\">A</span>. During the first $$$3$$$ seconds of trip tourist will be in the zone <span class=\"tex-font-style-tt\">B</span>. Then he will move to the zone <span class=\"tex-font-style-tt\">A</span> and will be scanned there on the $$$4$$$-th and the $$$8$$$-th second of his ride. Since he have a pass for this zone, he won't pay fines.</p><p>After the forth query, the fine in the zone <span class=\"tex-font-style-tt\">A</span> has become $$$3$$$.</p><p>In the fifth query, the airport can be located only near the station $$$7$$$ and $$$f(7) = 6$$$.</p><p>In the sixth query, the airport can be located near the station $$$6$$$ or near the station $$$8$$$. Since $$$f(6)=9$$$ and $$$f(8)=6$$$ the answer is $$$6$$$.</p>","ru":"<div class=\"section-title\">Примечание</div><p>Обратите внимание, что штраф может быть дешевле билета.</p><center> <img class=\"tex-graphics\" src=\"https://espresso.codeforces.com/4ab3919d8b1770894a43b03b4881c6598c667543.png\" style=\"max-width: 100.0%;max-height: 100.0%;\"> <span class=\"tex-font-size-small\">Транспортная сеть из примера. Зелёным обозначены станции и перегоны, находящиеся в зоне A, синим&nbsp;— в зоне B, красным&nbsp;— в зоне D. Около каждого перегона указано время, за которое его преодолевают поезда.</span> </center><p>В первом запросе аэропорт может быть расположен около станции $$$2$$$ или около станции $$$4$$$. Во время поездки, турист всегда будет в зоне <span class=\"tex-font-style-tt\">A</span>. У него уже есть билет для этой зоны, поэтому ответ $$$0$$$.</p><p>После второго запроса стоимость билета в зоне <span class=\"tex-font-style-tt\">A</span> стала равна $$$10$$$.</p><p>В третьем запросе аэропорт может быть расположен только около станции $$$3$$$. Оптимальным решением будет купить билет для зоны <span class=\"tex-font-style-tt\">A</span>. В течении первых $$$3$$$ секунд поездки турист будет в зоне <span class=\"tex-font-style-tt\">B</span>. Потом он попадёт в зону <span class=\"tex-font-style-tt\">A</span> и будет сканирован там на $$$4$$$-й и $$$8$$$-й секундах поездки. Так как у него есть билет для этой зоны, он не будет платить штраф.</p><p>После четвёртого запроса штраф в зоне <span class=\"tex-font-style-tt\">A</span> стал равен $$$3$$$.</p><p>В пятом запросе аэропорт может быть расположен только около станции $$$7$$$ и $$$f(7) = 6$$$.</p><p>В шестом запросе аэропорт может быть расположен около станции $$$6$$$ или около станции $$$8$$$. Так как $$$f(6)=9$$$ и $$$f(8)=6$$$ ответ равен $$$6$$$.</p>"},"sampleTestcases":[{"id":1641220815749,"input":"8\n1 2 7\n2 3 4\n2 4 3\n4 5 1\n5 6 6\n4 7 10\n6 8 6\n4\nAABABBDB\n11 12 10 42\n16 15 15 30\n4\n6\n3 2\n1 A 10\n3 3\n2 A 3\n3 7\n3 6\n","output":"0\n10\n6\n6\n"}],"submitUrl":"https://codeforces.com/contest/1621/submit","language":"c++","isPartOfContest":true}